## User Stories

As a user I want to...

  1. ... view the products available in the shop.
  - On larger devices, navigate to the 'Store' button on the left of the screen to display a list of all products in the shop. On mobile devices, click the three bar icon at the top of the screen and then click the Store button.
  2. ... read more information about a product.
  - Navigate to the Store page to return a list of all products in the shop. Click on the desired product to display a description.
  3. ... order an item from the store.
  - As above, select the product in the products page, and then click the Add to Cart button.
  4. ... modify the size or quantity of product I order.
  - As above, navigate to the specific product's page, a quantity selector appears where the user can use the buttons or type in their required amount. If the product comes in multiple sizes, a drop-down menu where this can be chosen will appear above the quantity selector.
  5. ... view my current cart.
  - Upon adding an item to the cart, a message bar at the top of the screen will display at the top of the page confirming this action, along with a link to the current cart in gold. From anywhere else on the site, the cart can be accessed by navigating to the gold cart icon with the current cart total next to it. This is on the left of the screen for large devices and at the top of the screen for smaller devices.
  6. ... edit or delete an item in my cart.
  - Access the cart as above, and each item within the cart will have a quantity selector similar to the one found in each Product page. To edit the quantity required, use the plus and minus buttons or type the value manually, then click the green Update button. To delete an item, simply press the red trash can icon.
  7. ... checkout my order.
  - Once the user has finalised their required products, click the 'Checkout' button. An item and order summary will be displayed, and any first-time users, whether checking out anonymously or using an account, will need to fill in the form to the right (on larger devices) or bottom (on smaller devices) of the screen. All fields except the Street Address 2 field are mandatory, and a valid credit or debit card number, expiry date and CVC number must be filled out. Upon clicking the 'Pay' button, the user will be taken to a confirmation screen, as well as receiving this information via e-mail.
  8. ... create an account.
  - Navigate to the 'Register' link on the left (large screens) or top (small screens) of the page. All elements of the Sign Up form are manadatory, the user will need to state and confirm their e-mail address, provide a username, and state and confirm a password that meets minimum security requirements.
  9. ... sign in to my account.
  - Navigate to the 'Sign In' link on the left (large screens) or top (small screens) of the page. Providing either the username or e-mail address given at sign-up, along with the correct password, will result in authentication.
  10. ... reset my password.
  - As above, navigate to the 'Sign in' link and click on the 'Forgot Your Password?' button. Enter your e-mail address and click 'Reset My Password' and an e-mail with further instructions will be sent to the e-mail address provided if it is associated with an account.
  11. ... edit my profile information.
  - Upon signing in on a larger device, navigate to the button containing the user's screen name on the left. All of the information underneath the 'My Profile Information can be edited. On mobile screens, open the menu at the top of the screen and select the button containing the user's username, then select the 'My Profile' button to get to the My Profile Information.
  12. ... view upcoming events.
  - Account holders can access the Events pages by navigating to the 'Event' link on the left (on larger screens) or top (on smaller screens) of the screen, to display a list of all upcoming events, as well as their date and time.
  13. ... sign up to an in-store event.
  - As above, navigate to the 'Events' link to return a list of all events. Click the 'Get Your Seat' button to bring up that event's specific page. Click the 'RSVP' button to reserve a ticket. If a red bar at the top displays 'Limited Availabiliy', under 10% of tickets remain. If the bar displays 'Sold Out', then no tickets remain and an RSVP button will not appear. If the RSVP button is replaced by a 'You've Got a Ticket!' message, the user has already signed up to this event.
  14. ... view events I have signed up to.
  - Navigate to the user's profile and a list of events will appear underneath the 'My Events' heading at the bottom of the page.
  15. ... remove an event from my events list.
  - As above, navigate to the user's profile to see a list of events underneath the 'My Events' heading. Click the trash can icon to remove the ticket from your events and make the ticket available to other users.
  16. ... view my order history.
  - Navigate to the user's profile and a list of all previous orders will appear to the right (on larger screens) or underneath (on smaller screens) the My Profile Information section, with the heading My Order History.
  17. ... view a particular previous order.
  - As above, navigate to the My Order History section of the user's profile, then click on the date of the required order. This will contain all of the information submitted by the user at the time of the order, even if they have subsequently updated their profile.
  18. ... save my address for future use.
  - There are two ways to do this. The user can manually update their information within their profile, or if they are completing the checkout form they can tick the box between the address form and the payment details.
  19. ... sign out of my account.
  - Navigate to the 'Sign Out' link at the right (larger screens) or top (smaller screens, via the menu and username) of the screen to be taken to a sign out confirmation screen.

As an admin, I want to...
  1. ... add a new product.
  - Navigate to the 'Admin' link on the left (larger screens) or via the menu at the top (smaller screens) of the screen to be taken to the administration panel. Click on the 'Add a Product' link to display a form; all fields on this form are mandatory except for the image fields.
  2. ... update a product.
  - Navigate to the 'Store' link on the left (larger screens) or via the menu at the top (smaller screens) of the screen to see a list of all products. Click on the required product and select the 'Edit' link underneath the 'Admin Controls' header. All fields on this form are mandatory except for the image fields.
  3. ... delete a product.
  - As above, navigate to the 'Store' link to see a list of all products. Click on the required product and select the 'Delete' link underneath the 'Admin Controls' header. The user will be prompted by a message before confirming deletion.
  4. ... view all orders.
  - Navigate to the 'Admin' link on the left (larger screens) or via the menu at the top (smaller screens) of the screen to be taken to the administration panel. Click on the 'View All Orders' link to display all orders, sorted by the most recent order first.
  5. ... view a specific order.
  - As above, navigate to the 'Admin' link and click on the 'View All Orders' button. To display the details that were sent to the customer's e-mail at the time of purchase, click on the date of the required order.
  6. ... add an event.
  - Navigate to the 'Admin' link on the left (larger screens) or via the menu at the top (smaller screens) of the screen to be taken to the administration panel. Click on the 'Add an Event' button to display a form; all fields on this form are mandatory except for the image fields.
  7. ... edit an event.
  - Navigate to the 'Events' link on the left (larger screens) or via the menu at the top (smaller screens) of the screen to see a list of all products. Click on the required event and select the 'Edit' link underneath the 'Admin Controls' header. All fields on this form are mandatory except for the image fields.
  8. ... delete an event.
  - As above, navigate to the 'Events' link to see a list of all products. Click on the required event and select the 'Delete' link underneath the 'Admin Controls' header. The user will be prompted by a message before confirming deletion.
  9. ... see a list of event attendees.
  - As above, navigate to the 'Events' link to see a list of all products. Click on the required event and a list of all attendees will be displayed beneath the Guestlist header, along with the event capacity and the number of places claimed by users.
  10. ... delete a user from an event.
  - As above, navigate to the 'Events' link to see a list of all products. Click on the required event and navigate to the Guestlist section. Select the trash can icon, and the user will be prompted by a message before confirming deletion.


## Bug Fixes

1. Highlight filtered category on selection: highlighting the sort options was pretty simple because the items are not added to a query. On the other hand, the category names are added to a QuerySet. For this portion of the project I was following a template from the Boutique Ado project so was wary of untangling something and breaking the whole operation, so after some painful attempts at extracting the items from the QuerySet I realised that I could capture them before they were added. These are created as lists so affixing [0] to the list name and setting as a new variable cat_list provided the solution seen in the [View Product](products/templates/view_product.html) page, namely '{% if 'snacks' == cat_list %}' in the category anchor tags.

2. Following on from bug #1, I noticed that the sorting buttons were not functioning as expected when items were already filtered by category. In the Code Institute [Boutique Ado tutorial](https://github.com/ckz8780/boutique_ado_v1/blob/656166307e469630d09e0eb17a0d17daa440e208/products/templates/products/products.html) I was following, the tutor used jQuery to isolate and amend the value attribute in a number of select items that were inside a drop-down menu. I had instead decided to use standalone buttons that would sit alongside the search bar and category buttons I had already added. Initially, a quick search on Stack Overflow and W3C told me that I couldn't add a value attribute to an anchor tag, but I could use a data-* attribute that was introduced with HTML5. A tutorial by 
[John Resig](https://johnresig.com/blog/html-5-data-attributes/) hinted that assigning a custom value would allow me to use the jQuery from the Boutique Ado project above. However, I then realised that in bug #1 I had set the cat_list variable to capture the category name, so I could probably write some simple Django logic to use a link dependent on cat_list, instead of add values to each link. I've yet to work out whether this is a 'better' or scalable solution than using the jQuery (it probably isn't), but I opted to use it purely because I came up with it just by thinking through the problem logically and really understanding the code I had already fixed.

3. As mentioned above, I followed the Boutique Ado project to get any core apps up and running during the [Minimum Viable Concept](https://www.agilealliance.org/glossary/mvp/) phase of my project, and consciously trying to make to stand apart as development progressed. In the tutorial the buttons were placed directly underneath the quantity form, but I moved the buttons to the right-most part of each item row. This caused the form submission to fail as the .prev jQuery function could no longer locate the  form. Javascript is definitely not my strong point so I needed the [jQuery documentation](https://api.jquery.com/siblings/) and the [W3 jQuery tutorials](https://www.w3schools.com/JQuery/jquery_traversing.asp) to refresh my memory. A chain of the parent, siblings and children methods provided the solution I needed after console-logging each step to ensure the correct element displayed.

4. I initially wrote this project with Materialize in mind as I had become familiar with the classes and components, but when I came to set up the checkout form I realised that crispy-forms doesn't offer native support for Materialize. My choices were either to write my own forms and logic or make the switch to Bootstrap while I still only had four apps to deal with. It was a couple of hours work to do this but it allowed me to follow a tutorial for a part of the project that links the front and back ends, namely the crispy forms and Stripe payments, without potentially creating a mountain of work for myself. I had previously preferred using Materialize to Bootstrap but switching over a ton of classes and removing the overwrites I'd done in my own CSS files gave me a new appreciation for Bootstrap.

5. I suspected that there was always likely to be some Materialize 'ghosts' floating around my codebase after converting to Bootstrap, and one that I found was in the shopping cart, where I discovered that the remove item. This was a pretty easy fix as I had left an onclick event containing Materialize's toast feature inside this button's attributes, and has omitted a class to tie it to the JS at the bottom of the page.

6. When it came to testing the cart I found that if it contained a product with no image, the cart was returning an error. This was due to the placement of an if loop inside an anchor, displayed an image if available and a placeholder otherwise. However, the anchor element href contained a link to this image, so I just needed to put the anchor element inside the loop to fix this.

7. I initially could not get my allauth templates to inherit from templates/base.html, but a quick call to Code Institute tutoring found the error, which was a missing comma in my settings.py file. Thanks to [Igor Basuga](https://github.com/bravoalpha79) for spotting that one.

8. I initially created the event_attendees database of something of a data dump for event and user ids to be added to the same row. As I did some [reading](https://riptutorial.com/django/example/30649/foreignkey), I realised that this could cause database problems if I deleted a user or event. I tested this and it seems to work fine, i.e. deleting an event and then re-opening a user's profile would see that event disappear, but something didn't sit right with leaving tons of user-event rows in the event_attendee database once they were no longer needed, and using foreign keys to ensure cascading deletion seemed to be the best-practice option. Once I got my head around the exact order of deleting old test attendee entries, updating models and migrating them, this was a relatively simple process.

9. My initial message display was overlapping headers on smaller screens when the message was too long. I tried restricting the maximum length of messages but this defeated the whole purpose of having one. I eventually found that the problem was actually caused by a vh height being set on the message-row tag. I then moved this above the page-header tagged elements and this provided a much improved user experience.

10. During testing I noticed that a couple of the dummy accounts I had set up could see the guestlist on events. This was intended to be an admin feature so quickly wrapping the entire row in the request.user.is_superuser statement was a simple fix.

11. Probably the error I'm happiest to have fixed was one where upon submitting an order, the webhook would then duplicate the order, at what seemed like random points. Obviously the likelihood of this occurrence actually being random was pretty low, so I had to start combing through my code. The cause was eventually identified as a rounding issue I had added into the cart/contexts.py file. Because the delivery threshold is a percentage, it means that any items that were sold in decimal values (e.g. €2.30, €2.70, etc.) created a grand total that was then being rounded up to the nearest ten. Once I removed the rounding function the problem was resolved.

12. Responsiveness testing (Known Issues #5 and #9) I found that things were generally working as planned but the iPad vertical view (width 768px) had significant whitespace at the top of the screen. I knew that in adding the mobile navbar I had added some margin in so it wouldn't overlap any content by default, but this was still showing up with my vertical navbar for large screens. The problem arises in a 
conflict between Bootstrap's default breakpoints and how I had defined my media queries. The medium breakpoint is equal to or greater than 768px, and I set my media query for that extra margin to sit behind the mobile navbar as 768px, instead of 767px, which was a simple fix at the bottom of the base.css document.

13. Model testing - I initially set the Eircode on the Order model and the date on the Event model as optional for entry. I've met plenty of people in Ireland who have no idea what their Eircode is, so I could probably have lived with that, but have a mandatory date when admins add events seemed like a no-brainer. A quick migration resolved these issues, and the built-in field prompts incrispy-forms meant that this was easily tested.

14. A typo made me realise that I'd gotten quite far into the project without handling bad URLs. Fortunately setting up error handlers in Django is as simple as creating files called 404.html and 500.html in the root template files.

15. Sorting search results (Known Issue #2) - I initially could not get returned search results to work with the sort buttons. I hit on the solution of adding an elif to the loop that was already in each sort button anchor on products.html, but was mistakenly trying to pass the query variable, when it had already been set as search_term in the context of the all_products view.

16. Regular expressions for form validation - My mentor pushed me to have better form validation in this project as I was marked down for it on MS3. I'm far from comfortable with the actual expressions themselves but Django's RegexValidator class helped once I had the actual patterns I needed. I used this to force a capacity greater than zero on all new events, and then used the widget attributes to make the phone number on the checkout form a number-only field.

17. A bug related to bug #11 re-emerged when prices were set to decimals not divisible by ten (e.g. €1.35), but this was resolved by using the widget attributes in products/form.py to set a minimum value of 0.10 (to prevent zero pricing similar to the dates in bug #16) and a step of 0.10. Ideally prices could be of any value but this at least prevents rounding errors from emerging once the webhook handler checks the database for orders.

18. When it came time to load new products into the store, I realised that everything was working fine apart from image uploads. I could still do this in the Django admin page so I knew there was a problem in my code. I went back through the Boutique Ado tutorial repository and found that I had set the form attribute 'enctype' as 'encytype'. Sometimes you real do have to use a fine-tooth comb to find those silent errors.


## Outstanding Issues

1. (Known Issue #4) Cart quantity will sometimes allow a user to submit a quantity outside of the parameters. This only occurs when there is more than one size of the same product in the basket, and it only affects the second of those sizes. For these items a customer can select a product quantity below zero. If the customer clicks the Update button at zero quantity, their cart will remove the product, but if they do not do this before checkout they will see the quantity of this item as 1 in the checkout screen. I tried and tried to fix this but ultimately left it too late to do anything about it, ultimately I'm paying the price for trying to use Materialize at the start of the project and then converting over to Bootstrap, when I should have been smart enough to use Bootstrap from the start.
2. (Known Issue #4) The cart quantity buttons on smaller devices do not render well, when I tried to fix this it fairly well messed up the js that allows the buttons to function at all. Again this is a consequence of trying to build my own version rather than simply following the tutorial on a core piece of logic. These two bugs will ultimately teach me that if I had my time again I will likely completely rebuild the cart from scratch.


## Rendering

I have graded all of the rendering options into four categories. Excellent marks something that is displaying as planned; Good is something which displays all functionality but not in the best way visually; average indicated that something is displaying incorrectly, such as a table scrolling or a header being skewed. The areas of concern I have are around the cart, I put it quite a lot of CSS and some jQuery to ensure this display everything, but I don't discount the idea that on other devices they may still display incorrectly. The other issue is the way that the Surface displays the landing header, and I couldn't seem to write enough CSS to fix this without ruining another device somewhere else. I also had some difficulties styling for the Galaxy Fold, which is only 280px wide.

<img src="planning/certs/responsiveness.png">

<img src="planning/certs/known-issues.png">


## Validation

### HTML

Each page was directly inputted into the [W3C HTML Validator](https://validator.w3.org/) to check that the markup used passed W3C standards. A number of validation issues arose as expected given the use of Django's templating and injection methods, especially since the validator recognises the curly bracket as an illegal URL character. Nevertheless running the validator is always a worthwhile task in catching any typos that may allow silent failures during development or are literally inconsequential but semantically confusing.

EXAMPLE SCREENSHOT HERE

### CSS

There are 7 CSS scripts in this project, one for each app except the bella_ciao and home apps, plus a base.css and a palette file just for colour selection. Where possible I've tried to re-use as much code as possible, so the base file is significantly longer than the rest, which are just used for tweaks within each app. These were validated using the [W3C CSS Validator](https://jigsaw.w3.org/css-validator/). All files passed for errors, and a handful of warning were displayed relating to unknown vendor extensions (for webkit transitions) and some Bootstrap override classes.

- base.css
<img src="planning/certs/jig-base.png">

- cart.css
<img src="planning/certs/jig-cart.png">

- checkout.css
<img src="planning/certs/jig-checkout.png">

- events.css
<img src="planning/certs/jig-events.png">

- palette.css
<img src="planning/certs/jig-palette.png">

- product.css
<img src="planning/certs/jig-product.png">

- profile.css
<img src="planning/certs/jig-profile.png">


SCREENSHOTS HERE

### JS/jQuery

There are 4 Javascript files in this project, they were validating using [JSHint](https://jshint.com/).

- cart.js
<img src="planning/certs/jshint-cart.png">

- quantitySelect.js
<img src="planning/certs/jshint-quantitySelect.png">

- script.js
<img src="planning/certs/jshint-script.png">

- stripe_elements.js
<img src="planning/certs/jshint-stripe_elements.png">

### Python PEP8

All Python scripts in this project were validated using the service at [PEP8 Online](http://pep8online.com/)

SCREENSHOTS HERE

### Lighthouse