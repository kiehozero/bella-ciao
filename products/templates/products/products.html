{% extends "base.html" %}
{% load static %}

{% block extratitle %}
Products |
{% endblock %}

{% block page_header %}

<!-- just here for colour and font testing at the moment -->
<div class="row landing-header">
    <div class="col-sm-12 landing-box">
        <h5 class="text-offwhite">Barista-made coffee poured in the heart of Limerick city</h5>
    </div>
</div>

{% endblock %}

{% block content %}

<div class="container">

    <!-- Preset product filters -->
    <div class="row center-align">
        <a class="waves-effect waves-light btn-small filter-button
        {% if current_categories == None %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}">
            All
        </a>
        <!-- Bugfix #1: Category selection highlighting -->
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'coffee' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=coffee">
            Coffee
        </a>
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'tea' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=tea">
            Tea
        </a>
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'hot_chocolate' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=hot_chocolate">
            Hot Chocolate
        </a>
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'sandwiches' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=sandwiches">
            Sandwiches
        </a>
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'snacks' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=snacks">
            Snacks
        </a>
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'desserts' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=desserts">
            Desserts
        </a>
        <a class="waves-effect waves-light btn-small filter-button
        {% if 'merchandise' == cat_list %} back-offwhite text-green{% else %} back-green text-offwhite{% endif %}"
            href="{% url 'products' %}?category=merchandise">
            Merchandise
        </a>
    </div>

    <!-- Search box and counter taken from Code Institute task manager tutorial -->
    <div class="row center-align text-red">
        <div class="col s12 l8">
            <form method="GET" action="{% url 'products' %}">
                <div class="row valign-wrapper center-align">

                    <!-- Search Box -->
                    <div class="input-field col s12 l8">
                        <!-- Not functioning with sort buttons, does the search item just need adding to if statement
                        in HTML below (see bugfix #2 note) -->
                        <input name="search" minlength="3" class="validate" type="text" required>
                        <label for="search">Search</label>
                    </div>

                    <!-- Buttons -->
                    <div class="col s12 l4">
                        <button type="submit" class="btn search-button text-offwhite back-green waves-effect waves-light"
                            id="searchButton">
                            Search
                        </button>
                        <a href="{% url 'products' %}"
                            class="btn search-button text-offwhite back-red waves-effect waves-light" id="searchReset">
                            Reset
                        </a>
                    </div>

                </div>
            </form>
        </div>

        <!-- Needs to work when filtered by category -->
        <div class="col s12 l4 valign-wrapper">
            <div class="row center-align">
                <small class="text-red">Sort by:&nbsp;&nbsp;</small>
                <!-- Bugfix #2: Category sorting -->
                <a href="{% if cat_list == None %}
                             {% url 'products' %}?sort=price&direction=asc
                         {% else %}
                             {% url 'products' %}?category={{ cat_list }}&sort=price&direction=asc
                         {% endif %}"
                    class="btn-small filter-button waves-effect waves-light {% if current_sort == 'price_asc' %}back-offwhite text-green{% else %}back-green text-offwhite{% endif %}">
                    <i class="fas fa-euro-sign"></i>
                </a>
                <a href="{% if cat_list == None %}
                             {% url 'products' %}?sort=price&direction=asc
                         {% else %}
                             {% url 'products' %}?category={{ cat_list }}&sort=name&direction=asc
                         {% endif %}"
                    class="btn-small filter-button waves-effect waves-light {% if current_sort == 'name_asc' %}back-offwhite text-green{% else %}back-green text-offwhite{% endif %}">
                    <i class="fas fa-sort-alpha-down"></i>
                </a>
                <a href="{% if cat_list == None %}
                             {% url 'products' %}?sort=price&direction=asc
                         {% else %}
                             {% url 'products' %}?category={{ cat_list }}&sort=name&direction=desc
                         {% endif %}"
                    class="btn-small filter-button waves-effect waves-light {% if current_sort == 'name_desc' %}back-offwhite text-green{% else %}back-green text-offwhite{% endif %}">
                    <i class="fas fa-sort-alpha-up-alt"></i>
                </a>
            </div>
        </div>
    </div>

    {% if search_term or current_categories or current_sort != 'None_None' %}
    <div class="row center-align">
        <span>
            <small>
                <!-- needs to switch to category.render_name somehow -->
                {{products|length }} items found{% if search_term %} for {{ search_term }}{% endif %}
            </small>
        </span>
    </div>
    {% endif %}

    <!-- Default Materialize card format -->
    <div class="row">

        {% for product in products %}

        <div class="col s12 l4">
            <div class="card shop-card">
                <div class="card-image">
                    {% if product.image %}
                    <a href="{% url 'view_product' product.id %}">
                        <!-- change to modal -->
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                    </a>
                    {% else %}
                    <img src="{{ MEDIA_URL }}placeholder.png" alt="{{ product.name }}">
                    {% endif %}
                </div>
                <div class="card-content">
                    <h6>
                        <a href="{% url 'view_product' product.id %}" class="text-red">{{ product.name }}</a>
                    </h6>
                </div>
                <div class="card-action text-offwhite right" style="width: 50%;">
                    <a href="#">
                        <i class="fas fa-cart-plus"></i>
                        <!-- Need a modal here that asks for size, milk or flavour where relevant -->
                    </a>
                </div>
                <div class="card-action text-offwhite left" style="width: 50%;">
                    â‚¬{{ product.price }}
                </div>
            </div>
        </div>

        {% endfor %}

    </div>

</div>

<div class="fixed-action-btn">
    <a class="btn-floating btn-large back-green text-offwhite" id="backToTop">
        <i class="fas fa-angle-double-up"></i>
    </a>
</div>

{% endblock %}

<!-- need a new footer for this page, having the order buttons at the bottom is confusing -->

{% block postloadjs %}
{{ block.super }}
<!-- idea taken from Boutique Ado -->
<script type="text/javascript">
    $('#backToTop').click(function() {
        window.scrollTo(0,0)
    })
</script>
{% endblock %}